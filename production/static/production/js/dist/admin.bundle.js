(()=>{"use strict";function e(e){const t=e.closest(".form-row"),o=e.closest(".dict-block__row");t.remove(),"e"!==o.dataset.id?(o.childNodes.forEach((function(e){e.hidden&&(e.hidden=!1)})),o.querySelector(".id-hidden").setAttribute("form","")):o.remove()}const t={country:"Country",producer:"Producer",materialType:"MaterialType",colorScheme:"ColorScheme",color:"Color",detailName:"DetailName",detailInGoods:"DetailInGoods",mainMaterial:"MainMaterial",addMaterial:"AddMaterial",masterBatch:"MasterBatch",recipe:"Recipe",recipeDetail:"RecipeDetail",goods:"Goods",imm:"IMM",productRequest:"ProductionRequest",productReport:"ProductionReport",requestStartStop:"ProductionRequestStartStop",productionForRequest:"ProductionForRequest",qualityForRequest:"QualityForRequest",defects:"Defects",defectEvent:"DefectEvent",qualityReport:"QualityReport",qualityReportDefect:"QualityReportDefects",recipeColorScheme:"RecipeColorScheme",detailBaseData:"DetailBaseData",detailActualData:"DetailActualData",immType:"ImmType",screwType:"ScrewType",ejectorType:"EjectorType",moldBase:"MoldBase",moldModifier:"MoldModifier",moldInsert:"MoldInsert",ejectorConnectorType:"EjectorConnectorType",clampingUnit:"ClampingUnit",ejector:"Ejector",injectionUnit:"InjectionUnit",immGeneralData:"ImmGeneralData",immAdditionalOptions:"ImmAdditionalOptions",detail:"DetailInGoods",material_type:"MaterialType",main_material_type:"MaterialType",color_scheme:"ColorScheme",detail_in_goods:"DetailInGoods",detail_name:"DetailName",main_material:"MainMaterial",add_material:"AddMaterial",masterbatch:"MasterBatch",main_master:"MasterBatch",add_master:"MasterBatch",product_request:"ProductionRequest",production_request:"ProductionRequest",defect_event:"DefectEvent",production_for_request:"ProductionForRequest",production:"ProductionReport",quality_report:"QualityReport",defect:"Defects",recipe_detail:"RecipeDetail",recipe_color_scheme:"RecipeColorScheme",detail_base_data:"DetailBaseData",detail_actual_data:"DetailActualData",imm_type:"ImmType",screw_type:"ScrewType",ejector_type:"EjectorType",mold_base:"MoldBase",mold_modifier:"MoldModifier",mold_insert:"MoldInsert",ejector_connector_type:"EjectorConnectorType",clamping_unit:"ClampingUnit",injection_unit:"InjectionUnit",imm_general_data:"ImmGeneralData",imm_additional_options:"ImmAdditionalOptions"};function o(e){return t[e.id.split("-")[0]]}function n(e){return fetch(e).then((e=>e.json()))}const a='\n    <div class="dropdown report_dropdown dropdown_dict">\n        <input name="" type="text" class="dropdown__hidden"\n               value="">\n        <div class="dropdown__input-block">\n            <input type="text" class="dropdown__input dropdown__input_dict"\n                   placeholder="Поиск.." \n                   value=""\n                   data-value="">\n            <i class="fa fa-solid fa-angle-down"></i>\n        </div>\n        <ul class="dropdown__content">\n        </ul>\n    </div>\n',d='<div class="dropdown report_dropdown dropdown_dict">\n        <input name="bool" type="text" class="dropdown__hidden"\n               value="1">\n        <div class="dropdown__input-block">\n            <input type="text" class="dropdown__input dropdown__input_dict"\n                   placeholder="Поиск.."\n                   value="Да"\n                   data-value="Да" readonly>\n            <i class="fa fa-solid fa-angle-down"></i>\n        </div>\n        <ul class="dropdown__content">\n            <li data-value="1">Да</li>\n            <li data-value="0">Нет</li>\n        </ul>\n    </div>\n';async function i(e){const o=e.closest(".dropdown"),a=o.closest("form"),d=o.querySelector(".dropdown__hidden").name,i=a.querySelector(`[data-filter="${d}"]`);if(o.querySelector(".dropdown__input").value=e.textContent.trim().replace(/\s+/g," "),o.querySelector(".dropdown__input").dataset.value=e.textContent.trim().replace(/\s+/g," "),o.querySelector(".dropdown__hidden").value=e.dataset.value,e.parentElement.classList.remove("visible"),i){const o=i.closest(".report_dropdown").querySelector("ul");o.innerHTML="",i.value="";const a=i.name;o.closest(".report_dropdown").querySelector(".dropdown__input").value="",o.closest(".report_dropdown").querySelector(".dropdown__input").dataset.value="";const r=`/production/dictionary_json_filter/${t[a]}/${t[d]}/${Number.parseInt(e.dataset.value)}`,l=await n(r);c(o,JSON.parse(l))}}function c(e,t){let o;t.forEach((t=>{o=document.createElement("li"),o.onclick=async function(e){e.stopPropagation(),await i(e.target)},o.dataset.value=Object.keys(t)[0],o.textContent=Object.values(t)[0],e.appendChild(o)}))}function r(e,t){e.contains(t.target)&&e.querySelector("ul").classList.add("visible")}async function l(l,s,u){let p=0;for(const e of u)"DIV"!==e.tagName||e.hidden||(e.classList.contains("foreign-key")?await m(e):e.classList.contains("bool-field")?await f(e):await _(e)),e.hidden=!0;async function _(e){let t;t=document.createElement("input"),t.classList.add("form-input","dict-block__text","dict__form-input"),null!=e.dataset.name?t.name=e.dataset.name:(t.readOnly=!0,t.classList.add("form-input__inactive")),e.classList.contains("date-field")?(t.type="datetime-local",t.value=function(e){const t=e.split(" "),o=t[0].split("."),n=t[1];return`${"20"+o[2]}-${o[1]}-${o[0]}T${n}`}(e.textContent)):(t.type="text",t.setAttribute("value",e.textContent)),s.appendChild(t),p+=1}async function m(e){let o;const d=e.closest(".dict-block__row"),i=t[e.dataset.name];o=document.createElement("div"),o.insertAdjacentHTML("beforeend",a),o.querySelector(".dropdown__input").addEventListener("keyup",(e=>{!function(e){let t,o,n;for(t=e.value.toUpperCase(),o=e.closest(".dropdown").getElementsByTagName("li"),n=0;n<o.length;n++)(o[n].textContent||o[n].innerText).toUpperCase().indexOf(t)>-1?o[n].style.display="":o[n].style.display="none"}(e.target)})),o=o.firstElementChild,o.addEventListener("click",(e=>{!function(e){let t;e.querySelector("ul").classList.contains("visible")&&(t=e),null==t||t.contains(e)||(t.querySelector("ul").classList.remove("visible"),t.querySelector(".dropdown__input").value=t.querySelector(".dropdown__input").dataset.value)}(o)})),o.addEventListener("click",(e=>{r(o,e)})),o.querySelector(".dropdown__hidden").name=e.dataset.name;const l=t[e.dataset.filter],s=o.querySelector(".dropdown__content");let u;if(l&&"e"!==d.dataset.id){const t=d.querySelector(`[data-name = "${e.dataset.filter}"]`).dataset.id;u=`/production/dictionary_json_filter/${i}/${l}/${Number.parseInt(t)}`,o.querySelector(".dropdown__hidden").dataset.filter=e.dataset.filter}else l?(o.querySelector(".dropdown__hidden").dataset.filter=e.dataset.filter,u="/production/dictionary_json_filter/default/default/0"):u=`/production/dictionary_json_filter/${i}/default/0`;const p=await n(u),_=JSON.parse(p);_||(o.querySelector(".dropdown__hidden").value=Object.keys(_[0])[0],o.querySelector(".dropdown__input_dict").value=Object.values(_[0])[0],o.querySelector(".dropdown__input_dict").dataset.value=Object.values(_[0])[0]),c(s,_),y(e,o)}async function f(e){let t;t=document.createElement("div"),t.insertAdjacentHTML("beforeend",d),t=t.firstElementChild,t.querySelectorAll("li").forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation(),i(e.target)}))})),t.querySelector(".dropdown__hidden").name=e.dataset.name,t.addEventListener("click",(e=>{r(t,e)})),y(e,t)}function y(e,t){t.querySelector(".dropdown__input").value=e.textContent.replace(/\s+/g," "),t.querySelector(".dropdown__input").dataset.value=e.textContent.replace(/\s+/g," "),t.querySelector(".dropdown__hidden").value=e.dataset.id,s.appendChild(t),p+=1}0!==p&&(l.querySelector(".id-hidden")&&l.querySelector(".id-hidden").setAttribute("form","form-dict"),s.appendChild(function(){let a;const d=document.createElement("div");return d.classList.add("dict__button-block","button-block"),a=document.createElement("button"),a.innerHTML='<i class="fa fa-solid fa-xmark" ></i>',a.classList.add("btn","btn-close","dict__btn"),a.addEventListener("click",(t=>{t.stopPropagation(),e(t.target)})),a.type="button",d.appendChild(a),a=document.createElement("button"),a.innerHTML='<i class="fa fa-solid fa-check"></i>',a.classList.add("btn","btn-save","dict__btn"),a.addEventListener("click",(e=>{e.stopPropagation(),function(e){event.preventDefault();const a=e.closest(".form-row"),d=a.parentElement.id.split("-")[0];!function(e,t){const a=e.querySelectorAll("[name]"),d=e.closest(".dict-block__row"),i=e.querySelector('[name = "quantity"]');if(!i||i.value&&"0"!==i.value){const i=new FormData(e);fetch(t,{method:"POST",body:i}).then((async()=>{if(a.forEach((e=>{e.classList.contains("dropdown__hidden")?d.querySelector(`[data-name = ${e.name}]`).textContent=e.parentElement.querySelector(".dropdown__input").value:d.querySelector(`[data-name = ${e.name}]`).textContent=e.value})),e.remove(),d.childNodes.forEach((function(e){e.hidden&&(e.hidden=!1)})),d.querySelector(".id-hidden").setAttribute("form",""),"e"===d.dataset.id){const e=`/production/dictionary_last_id/${o(d)}`,t=await n(e),a=JSON.parse(t).id__max;d.dataset.id=a,d.querySelector(".id-hidden").value=a,d.id=d.id.split("-")[0]+"-"+a}})).catch((e=>{console.error(e)}))}else e.remove(),"e"!==d.dataset.id?d.childNodes.forEach((function(e){e.hidden&&(e.hidden=!1)})):d.remove()}(a,"/production/dict_update/"+t[d])}(e.target)})),a.type="submit",d.appendChild(a),d}()),l.appendChild(s))}async function s(e){const t=e.childNodes,o=e.classList,n=document.createElement("form");n.classList.add("form-row"),o.forEach((function(e){"dict-block__row"!==e&&n.classList.add(e)})),n.id="form-dict",await l(e,n,t)}async function u(e,t,o){const n=o.querySelectorAll('div[data-field]:not([data-field = ""])');e.id?(o.dataset.id=e.id,o.id=o.id.slice(0,-1)+e.id,o.querySelector(".id-hidden").value=e.id):e.imm_id&&(o.dataset.id=e.imm_id,o.id=o.id.slice(0,-1)+e.imm_id,o.querySelector(".id-hidden").value=e.imm_id);const a=o.querySelector(".hex");a&&(a.style.backgroundColor=e.hex),e.date_close&&(o.classList.add("fulfilled"),o.querySelectorAll(".btn").forEach((e=>{e.setAttribute("disabled",!0),e.classList.add("form-input__inactive")})));for(const t of n){const o=t.dataset.field;t.classList.contains("bool-field")?(t.textContent=e[o]?"Да":"Нет",t.dataset.id=e[o]?"1":"0"):(t.textContent=e[o],t.classList.contains("foreign-key")&&(t.dataset.id=e[o+"_id"]))}}async function p(e,t,a,d,i){const c=e.dataset.last;let r;delete e.dataset.last;const l=t.querySelector(".dict-block__row_hidden"),s=`/production/json_dict_next_20/${o(e)}/${c}/default/${a}/${d}/${i}`,p=await n(s);let _=0;const m=[];for(const e of p)_++,r=l.cloneNode(!0),await u(e,0,r),r.classList.remove("dict-block__row_hidden"),20===_&&(r.dataset.last=Number.parseInt(c)+20),t.appendChild(r),m.push(r);return m}const _=document.querySelectorAll(".btn_add"),m=document.querySelectorAll(".search_submit"),f=document.querySelectorAll(".search_clear"),y=document.getElementById("showDeleted")?1:0,h=document.querySelectorAll(".dict-block__content");async function v(e,t){t===e.target.closest(".dict-block__row")&&(e.target.classList.contains("btn_delete")?await async function(e,t){const n=e.dataset.id,a=`/production/dict_delete/${o(e)}/${n}`;t?e.querySelector('[data-name = "deleted"]').textContent="Да":e.remove(),await fetch(a)}(t,y):await s(e.target.closest(".dict-block__row")))}document.querySelectorAll("summary").forEach((e=>{e.addEventListener("click",(async e=>{const t=e.target.closest("details");await async function(e,t){const o=e.id+"-0",n=document.getElementById(o).closest(".dict-block"),a=n.querySelector(".dict-block__content"),d=n.querySelector(".dict-block__row_hidden"),i=d.cloneNode(!0);i.setAttribute("data-last","0"),a.appendChild(i),a.appendChild(d),await p(i,a,"default",t,0),i.remove()}(t,y)}),{once:!0})})),window.onload=function(){const e=document.querySelectorAll(".dict-block__header_block-space"),t=function(e){32===e.keyCode&&e.preventDefault()};e.forEach((e=>{e.onkeyup=t}))},addEventListener("mousedown",(function(t){try{const o=document.querySelector("form").closest(".dict-block__row");t.target===o||o.contains(t.target)||e(document.querySelector("form").querySelector(".btn-close"))}catch(e){}})),h.forEach((e=>{e.addEventListener("mouseover",(async t=>{const o=e.querySelector('div[data-last]:not([data-last = ""])');if(t.target===o){let t=function(e){let t="";return e.closest(".dict-block").querySelector(".dict-block__form-input")&&(t=e.closest(".dict-block").querySelector(".dict-block__form-input").value),""===t&&(t="default"),t}(o);t||(t=""),await p(o,e,t,0,0)}}))})),_.forEach((e=>{e.addEventListener("click",(async t=>{t.preventDefault(),await async function(e,t){if(e.target===t){const e=function(e){const t=e.cloneNode(!0);return t.id=t.id.slice(0,-1)+"e",t.dataset.id="e",e.after(t),t.classList.remove("dict-block__row_hidden"),t}(t.closest(".dict-block").querySelector(".dict-block__row_hidden"));await s(e)}}(t,e)}))})),h.forEach((e=>{e.addEventListener("click",(async t=>{const o=e.querySelectorAll(".dict-block__row");for(const e of o)await v(t,e)}))})),m.forEach((e=>{e.addEventListener("mousedown",(async e=>{const t=function(e,t){const o=t.target.closest(".dict-block"),n=function(e){const t=e.querySelector(".form-input").value;let o;return o=""===t?"default":t.replaceAll(/  +/g," ").replaceAll(" ","_"),o}(o),a=o.querySelector(".dict-block__content"),d=a.querySelector(".dict-block__row_hidden"),i=d.cloneNode(!0);return i.setAttribute("data-last","0"),a.appendChild(i),a.innerHTML="",a.appendChild(d),[i,n,a]}(0,e);await p(t[0],t[2],t[1],y,0),t[0].remove()}))})),f.forEach((e=>{e.addEventListener("click",(t=>{e.closest(".dict-block__search").querySelector(".form-input").value=""}))}))})();